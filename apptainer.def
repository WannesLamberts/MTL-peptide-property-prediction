# Apptainer definition file
Bootstrap: docker
From: continuumio/miniconda3

%post
    # Set working directory inside the container
    mkdir /app
    cd /app

    # Copy the environment file (Assumes that 'environment.yml' is present in the build context)
    cp /mnt/host/environment.yml /app/

    # Create the conda environment and clean up
    conda env create -f /app/environment.yml
    conda clean --all -y

%environment
    # Set environment variables for the conda environment
    export PATH=/opt/conda/envs/my_env/bin:$PATH
    export CONDA_PREFIX=/opt/conda/envs/my_env

%runscript
    # Set shell to use conda environment
    exec /opt/conda/envs/my_env/bin/bash -c "$@"

%files
    # Copy the entire project into the container
    . /app
